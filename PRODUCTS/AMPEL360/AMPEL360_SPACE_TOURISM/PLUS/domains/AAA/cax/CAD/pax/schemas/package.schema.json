{
  "$id": "https://asi-t2.schemas/pax/package.cad.v1.1.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "PAx Package Manifest — CAD (AMPEL360 PLUS)",
  "description": "Strict schema for CAD-domain packaging (OB/OFF) with UTCS/QS evidence.",
  "type": "object",
  "additionalProperties": false,
  "required": ["utcs_header", "package", "security", "evidence"],
  "properties": {
    "utcs_header": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "id","project","artifact","llc","classification","version",
        "release_date","maintainer","bridge","ethics_guard","utcs_mi","canonical_hash"
      ],
      "properties": {
        "id":             { "type": "string", "pattern": "^ASIT[-A-Z0-9_.]+$" },
        "project":        { "type": "string" },
        "artifact":       { "type": "string" },
        "llc":            { "type": "string", "enum": ["SYSTEMS","STATIONS","COMPONENTS","BITS","QUBITS","ELEMENTS","WAVES","STATES"] },
        "classification": { "type": "string" },
        "version":        { "type": "string", "pattern": "^\\d+\\.\\d+\\.\\d+(?:-[A-Za-z0-9.-]+)?$" },
        "release_date":   { "type": "string", "format": "date" },
        "maintainer":     { "type": "string" },
        "bridge":         { "type": "string", "pattern": "^CB→QB→UE→FE→FWD→QS$" },
        "ethics_guard":   { "type": "string", "enum": ["MAL-EEM"] },
        "utcs_mi":        { "type": "string", "enum": ["v5.0"] },
        "canonical_hash": { "type": "string", "pattern": "^(TBD|sha256:[a-f0-9]{64})$" }
      }
    },
    "package": {
      "type": "object",
      "additionalProperties": false,
      "required": ["name", "kind"],
      "properties": {
        "name": { 
          "type": "string",
          "pattern": "^PLUS-CAD-[A-Z0-9-]+$",
          "description": "Package name (e.g., PLUS-CAD-EXPORTER-001)"
        },
        "kind": { "type": "string", "enum": ["OB-CAD-TOOL","OFF-CAD-EXPORTER","OFF-CAD-VALIDATOR"] },
        "target": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "platform": { "type": "string" },
            "os": { "type": "string" },
            "arch": { "type": "string" },
            "cad_system": { "type": "string", "enum": ["CATIA","NX","Fusion360","SolidWorks","Generic"] },
            "oci": { "type": "object" },
            "version_requirements": { "type": "object" }
          }
        },
        "resources": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "cpu": { "type": "number" },
            "memory_mb": { "type": "number" },
            "storage_mb": { "type": "number" },
            "gpu_required": { "type": "boolean" }
          }
        },
        "interfaces": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "cad_api": { "type": "array", "items": { "type": "string" } },
            "file_formats": { "type": "array", "items": { "type": "string" } },
            "network": { "type": "array", "items": { "type": "string" } },
            "quantum_backend": { "type": "array", "items": { "type": "string" } }
          }
        },
        "cad_specific": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "supported_formats": {
              "type": "array",
              "items": {"enum": ["STEP", "IGES", "Parasolid", "STL", "X_T"]}
            },
            "geometry_types": {
              "type": "array", 
              "items": {"enum": ["OML", "STRUCTURE", "TPS", "INTERFACE", "ASSEMBLY"]}
            },
            "validation_rules": {"type": "array", "items": {"type": "string"}},
            "export_presets": {"type": "object"}
          }
        },
        "dependencies": {"type": "array", "items": {"type": "string"}}
      }
    },
    "security": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "signing": {"type": "object"},
        "constraints": {"type": "object"},
        "cad_security": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "geometry_sanitization": {"type": "boolean"},
            "metadata_stripping": {"type": "boolean"},
            "export_validation": {"type": "boolean"}
          }
        }
      }
    },
    "evidence": {
      "type": "object",
      "additionalProperties": false,
      "required": ["canonical_hash", "sbom", "signatures", "security_policy_id"],
      "properties": {
        "canonical_hash": {
          "type": "string",
          "pattern": "^sha256:[a-f0-9]{64}$"
        },
        "sbom": {
          "type": "object",
          "additionalProperties": false,
          "required": ["path", "hash"],
          "properties": {
            "path": {"type": "string"},
            "hash": {"type": "string", "pattern": "^sha256:[a-f0-9]{64}$"},
            "format": {"enum": ["SPDX", "CycloneDX"]}
          }
        },
        "signatures": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["path", "type"],
            "properties": {
              "path": {"type": "string"},
              "type": {"enum": ["cosign", "in-toto", "x509"]},
              "keyid": {"type": "string"}
            }
          }
        },
        "security_policy_id": {"type": "string"},
        "qs_path": {"type": "string"},
        "attestations": {"type": "array", "items": {"type": "string"}},
        "cad_validation": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "geometry_checks": {"type": "array", "items": {"type": "string"}},
            "naming_compliance": {"type": "boolean"},
            "schema_validation": {"type": "boolean"}
          }
        },
        "notes": {"type": "string"}
      }
    }
  }
}