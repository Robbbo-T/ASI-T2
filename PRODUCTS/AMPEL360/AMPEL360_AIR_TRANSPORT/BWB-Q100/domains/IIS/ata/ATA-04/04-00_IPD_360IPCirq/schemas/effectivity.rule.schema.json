{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://asi-t2.org/schemas/effectivity/rule/v1.0.0",
  "title": "Effectivity Rule Schema",
  "description": "Schema for CO-3.16: Effectivity rule configurable object",
  "type": "object",
  "required": [
    "rule_id",
    "expr"
  ],
  "properties": {
    "rule_id": {
      "type": "string",
      "description": "Unique identifier for this effectivity rule",
      "pattern": "^EFF-[0-9]{6}$"
    },
    "expr": {
      "type": "string",
      "description": "Effectivity expression (MSN ranges, options, blocks, etc.)",
      "minLength": 1,
      "maxLength": 500
    },
    "start": {
      "type": "string",
      "description": "Start of effectivity (MSN, date, or block)",
      "pattern": "^(MSN-[0-9]{4,6}|BLOCK-[0-9]{1,3}|[0-9]{4}-[0-9]{2}-[0-9]{2})$"
    },
    "end": {
      "type": "string",
      "description": "End of effectivity (optional, MSN, date, or block)",
      "pattern": "^(MSN-[0-9]{4,6}|BLOCK-[0-9]{1,3}|[0-9]{4}-[0-9]{2}-[0-9]{2}|OPEN)$"
    },
    "exclude": {
      "type": "array",
      "description": "List of excluded MSNs or ranges",
      "items": {
        "type": "string",
        "pattern": "^MSN-[0-9]{4,6}(-MSN-[0-9]{4,6})?$"
      }
    },
    "aircraft_type": {
      "type": "string",
      "description": "Aircraft type designation",
      "pattern": "^[A-Z0-9-]{3,20}$"
    },
    "variant": {
      "type": "string",
      "description": "Aircraft variant designation",
      "pattern": "^[A-Z0-9-]{1,10}$"
    },
    "option_codes": {
      "type": "array",
      "description": "Required option codes for this effectivity",
      "items": {
        "type": "string",
        "pattern": "^OPT-[A-Z0-9]{3,6}$"
      }
    },
    "condition": {
      "type": "string",
      "description": "Additional conditional logic",
      "enum": ["AND", "OR", "NOT", "XOR"]
    },
    "status": {
      "type": "string",
      "description": "Status of this effectivity rule",
      "enum": ["ACTIVE", "PENDING", "SUPERSEDED", "CANCELLED"]
    },
    "reference_documents": {
      "type": "array",
      "description": "Reference documents (SBs, mods, etc.)",
      "items": {
        "type": "object",
        "required": ["type", "number"],
        "properties": {
          "type": {
            "type": "string",
            "enum": ["SB", "MOD", "AD", "CN", "ECO"]
          },
          "number": {
            "type": "string"
          },
          "title": {
            "type": "string"
          }
        }
      }
    },
    "notes": {
      "type": "string",
      "description": "Additional notes or instructions",
      "maxLength": 1000
    },
    "metadata": {
      "type": "object",
      "description": "Additional metadata",
      "properties": {
        "created_by": {
          "type": "string"
        },
        "created_date": {
          "type": "string",
          "format": "date-time"
        },
        "modified_by": {
          "type": "string"
        },
        "modified_date": {
          "type": "string",
          "format": "date-time"
        },
        "approved_by": {
          "type": "string"
        },
        "approval_date": {
          "type": "string",
          "format": "date-time"
        }
      }
    }
  },
  "additionalProperties": false
}
